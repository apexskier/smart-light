<!DOCTYPE html><meta charset=utf-8><title>Smart Light</title><style>body{font-family:sans-serif;color:#222;padding:10px 15px}.lightbox-container{width:100%;text-align:center;margin-bottom:10px}#lightbox{margin:0 auto;height:100px;width:100px;border-radius:4px;border:1px solid #222}#preview{display:inline-block;background-color:#fff;height:1em;width:1em;margin-left:.5em;vertical-align:text-bottom}#message{border-radius:2px;background-color:#ffcdcd;color:#9e0000;border:1px solid;padding:4px 8px;display:none}</style><h1>Smart Light</h1><p id=message><div class=lightbox-container><div id=lightbox></div></div><p><button id=turnOff>Off</button> <button id=refresh>Refresh</button><p>Red <input id=red value=255 type=range step=1 min=0 max=255><br>Green <input id=green value=255 type=range step=1 min=0 max=255><br>Blue <input id=blue value=255 type=range step=1 min=0 max=255><br><p><button id=setButton>Set</button> <span id=preview></span></p><script>function setPreview(){preview.style.backgroundColor=\"rgb(\"+newColor[0]+\",\"+newColor[1]+\",\"+newColor[2]+\")\"}function error(e){message.textContent=\"Error: \"+(error.response||\"unknown error\"),message.style.display=\"block\"}function update(){ajax(\"GET\",\"/status\",function(e){var t=JSON.parse(e);lightbox.style.backgroundColor=\"rgb(\"+t.color.r+\",\"+t.color.g+\",\"+t.color.b+\")\",message.style.display=\"none\"},error)}function ajax(e,t,n,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState==XMLHttpRequest.DONE&&(200==o.status?n(o.responseText):r(o))},o.open(e,t,!0),o.send()}var lightbox=document.getElementById(\"lightbox\"),message=document.getElementById(\"message\"),preview=document.getElementById(\"preview\"),redSlider=document.getElementById(\"red\"),blueSlider=document.getElementById(\"blue\"),greenSlider=document.getElementById(\"green\"),offButton=document.getElementById(\"turnOff\"),refreshButton=document.getElementById(\"refresh\"),setButton=document.getElementById(\"setButton\"),newColor=[255,255,255];redSlider.addEventListener(\"input\",function(e){newColor[0]=e.target.value,setPreview()}),greenSlider.addEventListener(\"input\",function(e){newColor[1]=e.target.value,setPreview()}),blueSlider.addEventListener(\"input\",function(e){newColor[2]=e.target.value,setPreview()}),offButton.addEventListener(\"click\",function(e){ajax(\"POST\",\"/off?duration=1000\",update,error)}),setButton.addEventListener(\"click\",function(e){ajax(\"POST\",\"/color?r=\"+newColor[0]+\"&g=\"+newColor[1]+\"&b=\"+newColor[2]+\"&duration=1000\",update,error)}),refreshButton.addEventListener(\"click\",function(e){update()}),update()</script>
